# 直播应用 (Live App)

## 📱 概述

这是一个完全重写的直播应用，专为SillyTavern手机界面设计。应用能够实时监听SillyTavern的上下文变化，解析特定格式的直播数据，并提供丰富的直播间体验。

## ✨ 主要功能

### 🎯 核心功能
- **实时监听**: 监听SillyTavern的AI回复，自动解析直播数据
- **数据解析**: 支持五种直播格式数据的解析
- **状态管理**: 支持直播状态保存和恢复
- **手机集成**: 完美集成到手机框架中

### 📊 数据格式支持
1. **直播人数**: `[直播|本场人数|数字]`
2. **直播内容**: `[直播|直播内容|内容]`
3. **普通弹幕**: `[直播|用户名|弹幕|弹幕内容]`
4. **打赏弹幕**: `[直播|用户名|打赏|打赏礼物]`
5. **推荐互动**: `[直播|推荐互动|互动内容]`

### 🎨 界面特色
- **现代化设计**: 基于样式参考的美观界面
- **动态效果**: 弹幕滚动、按钮动画、数字变化等
- **响应式布局**: 适配不同屏幕尺寸
- **深色模式**: 支持系统深色模式

## 🚀 使用方法

### 开始直播
1. 点击手机主屏幕的"直播"应用图标
2. 选择预设互动或输入自定义互动内容
3. 点击"开始直播"按钮
4. 应用将自动向SillyTavern发送开始直播的消息

### 直播中操作
- **查看弹幕**: 实时显示普通弹幕和打赏弹幕
- **互动选择**: 点击推荐互动按钮或自定义互动
- **查看礼物**: 点击礼物按钮查看打赏记录
- **观看人数**: 实时显示当前观看人数

### 结束直播
- 点击右上角的结束直播按钮
- 确认后停止监听并清理数据

## 🔧 技术架构

### 核心组件
- **LiveApp**: 主应用类，协调各组件工作
- **LiveEventListener**: 事件监听器，监听SillyTavern消息
- **LiveDataParser**: 数据解析器，解析直播格式数据
- **LiveStateManager**: 状态管理器，管理直播状态和数据
- **LiveMessageSender**: 消息发送器，向SillyTavern发送消息

### 数据流
```
SillyTavern消息 → 事件监听 → 数据解析 → 状态更新 → UI渲染
```

### 集成方式
- 通过全局函数与手机框架集成
- 支持动态加载和卸载
- 提供错误处理和恢复机制

## 🧪 测试功能

应用内置了完整的测试和调试功能：

### 测试命令
```javascript
// 测试数据解析功能
window.testLiveDataParsing();

// 测试手机框架集成
window.testMobileIntegration();

// 运行所有测试
window.runAllTests();
```

### 调试工具
```javascript
// 查看调试日志
window.liveAppDebugger.getLogs();

// 导出日志
window.liveAppDebugger.exportLogs();

// 清理日志
window.liveAppDebugger.clearLogs();
```

## 📁 文件结构

```
app/
├── live-app.js          # 主应用逻辑
├── live-app.css         # 样式文件
└── README.md           # 使用说明
```

## 🔄 数据持久化

- 使用localStorage保存直播状态
- 支持跨浏览器会话的数据恢复
- 自动清理过期数据

## 🎯 兼容性

- 支持现代浏览器
- 兼容SillyTavern插件系统
- 适配手机界面框架

## 🐛 故障排除

### 常见问题
1. **无法监听消息**: 检查SillyTavern事件系统是否可用
2. **数据解析失败**: 确认消息格式是否正确
3. **界面显示异常**: 检查CSS文件是否正确加载

### 调试步骤
1. 打开浏览器开发者工具
2. 运行 `window.runAllTests()` 检查功能
3. 查看控制台日志了解详细错误信息
4. 使用 `window.liveAppDebugger.getLogs()` 查看调试日志

## 📝 更新日志

### v2.0.0 (当前版本)
- 完全重写应用架构
- 新增动态效果和动画
- 改进数据解析和状态管理
- 增强手机框架集成
- 添加测试和调试功能

## 🤝 贡献

欢迎提交问题报告和功能建议！

## 📄 许可证

本项目遵循MIT许可证。
