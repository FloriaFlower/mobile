# 微博应用开发者使用指南

## 快速开始

### 1. 环境准备
确保以下模块已正确加载：
- `mobileContextEditor` - 上下文编辑器
- `mobileCustomAPIConfig` - API配置模块
- `mobilePhone` - 手机框架（可选）

### 2. 初始化检查
```javascript
// 检查依赖模块
console.log('上下文编辑器:', !!window.mobileContextEditor);
console.log('API配置:', !!window.mobileCustomAPIConfig);
console.log('微博管理器:', !!window.weiboManager);
console.log('微博UI:', !!window.weiboUI);
console.log('自动监听器:', !!window.weiboAutoListener);
```

### 3. 基本配置
```javascript
// 设置API配置
window.mobileCustomAPIConfig.setConfig({
    url: 'your-api-url',
    apiKey: 'your-api-key',
    model: 'your-model-name'
});

// 选择微博风格
window.weiboManager.currentSettings.selectedStyle = '微博网友';

// 设置生成阈值
window.weiboManager.currentSettings.threshold = 10;
```

## 核心API使用

### 微博管理器 (WeiboManager)

**生成微博内容：**
```javascript
// 手动生成微博内容
await window.weiboManager.generateWeiboContent();

// 检查是否正在处理
if (window.weiboManager.isCurrentlyProcessing()) {
    console.log('正在生成中...');
}
```

**设置管理：**
```javascript
// 获取当前设置
const settings = window.weiboManager.getSettings();

// 设置阈值
window.weiboManager.setThreshold(15);

// 启用/禁用自动更新
window.weiboManager.setAutoUpdate(true);

// 保存设置
window.weiboManager.saveSettings();
```

**发送用户内容：**
```javascript
// 发送用户微博
await window.weiboManager.sendPostToAPI('用户发布的微博内容');

// 发送用户评论
await window.weiboManager.sendReplyToAPI('用户的评论内容');
```

**清除微博内容：**
```javascript
// 清除所有微博内容
await window.weiboManager.clearWeiboContent();
```

### 微博UI (WeiboUI)

**获取界面HTML：**
```javascript
// 获取微博主界面
const html = window.weiboUI.getWeiboMainHTML();

// 绑定事件
window.weiboUI.bindEvents();
```

**刷新内容：**
```javascript
// 刷新微博列表
window.weiboUI.refreshWeiboList();

// 切换标签页
window.weiboUI.switchTab('personal'); // 'hot', 'personal', 'cp'
```

**获取微博数据：**
```javascript
// 获取当前微博数据
const weiboData = window.weiboUI.getCurrentWeiboData();
console.log('热搜:', weiboData.hotSearches);
console.log('博文:', weiboData.posts);
console.log('评论:', weiboData.comments);
```

### 自动监听器 (WeiboAutoListener)

**控制监听：**
```javascript
// 开始监听
window.weiboAutoListener.start();

// 停止监听
window.weiboAutoListener.stop();

// 检查监听状态
if (window.weiboAutoListener.isListening) {
    console.log('正在监听中');
}
```

**设置配置：**
```javascript
// 更新设置
window.weiboAutoListener.updateSettings({
    checkIntervalMs: 3000,  // 检查间隔
    debounceMs: 1000,       // 防抖延迟
    enabled: true           // 是否启用
});

// 启用/禁用监听
window.weiboAutoListener.setEnabled(true);

// 设置检查间隔
window.weiboAutoListener.setCheckInterval(5000);
```

**获取统计信息：**
```javascript
// 获取统计数据
const stats = window.weiboAutoListener.getStats();
console.log('监听状态:', stats.isListening);
console.log('生成次数:', stats.generationCount);
console.log('最后生成时间:', stats.lastGenerationTime);

// 重置统计
window.weiboAutoListener.resetStats();
```

**手动触发：**
```javascript
// 手动触发生成
await window.weiboAutoListener.manualTrigger();
```

**诊断功能：**
```javascript
// 获取诊断信息
const diagnosis = window.weiboAutoListener.diagnose();
console.log('诊断结果:', diagnosis);
```

### 微博风格 (WeiboStyles)

**风格管理：**
```javascript
// 获取所有可用风格
const styles = window.weiboStyles.getAvailableStyles();

// 检查风格是否存在
if (window.weiboStyles.hasStyle('微博网友')) {
    console.log('风格存在');
}

// 获取风格提示词
const prompt = window.weiboStyles.getStylePrompt('微博网友');
```

**自定义前缀：**
```javascript
// 设置自定义前缀
window.weiboStyles.setCustomPrefix('请生成更多搞笑内容');

// 获取当前前缀
const prefix = window.weiboStyles.getCustomPrefix();

// 清空前缀
window.weiboStyles.clearCustomPrefix();

// 获取前缀状态
const status = window.weiboStyles.getPrefixStatus();
```

**自定义风格：**
```javascript
// 添加自定义风格
window.weiboStyles.addCustomStyle('我的风格', '自定义提示词...');

// 删除自定义风格
window.weiboStyles.removeCustomStyle('我的风格');
```

## 事件监听

### 监听微博生成事件
```javascript
// 监听生成状态变化
const originalUpdateStatus = window.weiboManager.updateGenerationStatus;
window.weiboManager.updateGenerationStatus = function(status) {
    console.log('生成状态:', status);
    originalUpdateStatus.call(this, status);
};
```

### 监听用户交互
```javascript
// 监听用户发微博
document.addEventListener('click', (e) => {
    if (e.target.id === 'submit-post-btn') {
        console.log('用户正在发微博');
    }
});
```

## 调试和诊断

### 控制台命令
```javascript
// 微博管理器命令
WeiboManager.generateWeiboContent()     // 生成微博
WeiboManager.showWeiboPanel()          // 显示控制面板
WeiboManager.testWeiboUpdate()         // 测试更新
WeiboManager.checkFirstLayerStatus()   // 检查第1楼层状态

// 监听器命令
WeiboListener.start()                  // 开始监听
WeiboListener.stop()                   // 停止监听
WeiboListener.diagnose()               // 诊断信息
WeiboListener.toggleStatusPanel()      // 切换状态面板
```

### 日志监控
```javascript
// 启用详细日志
localStorage.setItem('weibo_debug', 'true');

// 监控API调用
const originalCallAPI = window.mobileCustomAPIConfig.callAPI;
window.mobileCustomAPIConfig.callAPI = function(...args) {
    console.log('API调用:', args);
    return originalCallAPI.apply(this, args);
};
```

### 状态检查
```javascript
// 检查系统状态
function checkWeiboStatus() {
    return {
        manager: {
            initialized: window.weiboManager?.isInitialized,
            processing: window.weiboManager?.isCurrentlyProcessing()
        },
        listener: {
            listening: window.weiboAutoListener?.isListening,
            enabled: window.weiboAutoListener?.settings?.enabled
        },
        ui: {
            loaded: !!window.weiboUI,
            currentTab: window.weiboUI?.currentTab
        },
        api: {
            available: window.mobileCustomAPIConfig?.isAPIAvailable()
        }
    };
}
```

## 常见问题解决

### 1. 微博内容不生成
```javascript
// 检查API配置
if (!window.mobileCustomAPIConfig?.isAPIAvailable()) {
    console.error('API未配置或不可用');
}

// 检查监听器状态
if (!window.weiboAutoListener?.isListening) {
    console.log('监听器未启动');
    window.weiboAutoListener.start();
}

// 检查阈值设置
const threshold = window.weiboManager.getSettings().threshold;
console.log('当前阈值:', threshold);
```

### 2. 界面显示异常
```javascript
// 强制刷新界面
window.weiboUI.refreshWeiboList();

// 重新绑定事件
window.weiboUI.bindEvents();

// 检查数据
const data = window.weiboUI.getCurrentWeiboData();
console.log('微博数据:', data);
```

### 3. 自动监听不工作
```javascript
// 重启监听器
window.weiboAutoListener.stop();
setTimeout(() => {
    window.weiboAutoListener.start();
}, 1000);

// 检查设置
const settings = window.weiboAutoListener.settings;
console.log('监听器设置:', settings);
```

## 扩展开发

### 添加新的微博风格
```javascript
// 在weibo-styles.js中添加
window.weiboStyles.addCustomStyle('新风格', `
你是一位新风格的博主...
请根据提供的聊天记录生成微博内容...
`);
```

### 自定义UI组件
```javascript
// 扩展微博UI
window.weiboUI.addCustomTab = function(tabName, content) {
    // 添加新标签页的逻辑
};
```

### 集成外部服务
```javascript
// 添加图片上传功能
window.weiboManager.uploadImage = async function(imageFile) {
    // 图片上传逻辑
};
```

这个指南涵盖了微博应用的主要开发接口和使用方法，可以帮助开发者快速上手和扩展功能。
