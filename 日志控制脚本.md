# Message-App 日志控制脚本

## 快速控制命令

### 一键关闭所有调试日志（推荐）
```javascript
// 在浏览器控制台执行以下命令
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = false;
window.DEBUG_CONTEXT_EDITOR = false;
window.DEBUG_REAL_TIME_SYNC = false;
window.DEBUG_FORUM_AUTO_LISTENER = false;
window.DEBUG_WEIBO_AUTO_LISTENER = false;
console.clear();
console.log('✅ 所有调试日志已关闭，控制台已清理');
```

### 一键启用所有调试日志（问题排查时）
```javascript
window.DEBUG_MESSAGE_APP = true;
window.DEBUG_MESSAGE_RENDERER = true;
window.DEBUG_FRIEND_RENDERER = true;
window.DEBUG_CONTEXT_MONITOR = true;
window.DEBUG_CONTEXT_EDITOR = true;
window.DEBUG_REAL_TIME_SYNC = true;
window.DEBUG_FORUM_AUTO_LISTENER = true;
window.DEBUG_WEIBO_AUTO_LISTENER = true;
console.log('✅ 所有调试日志已启用');
```

### 选择性启用调试日志

#### 只启用Message-App核心日志
```javascript
window.DEBUG_MESSAGE_APP = true;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = false;
console.log('✅ 已启用Message-App核心日志');
```

#### 只启用消息渲染日志
```javascript
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = true;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = false;
console.log('✅ 已启用消息渲染日志');
```

#### 只启用好友渲染日志
```javascript
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = true;
window.DEBUG_CONTEXT_MONITOR = false;
console.log('✅ 已启用好友渲染日志');
```

#### 只启用上下文监控日志
```javascript
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = true;
window.DEBUG_CONTEXT_EDITOR = false;
window.DEBUG_REAL_TIME_SYNC = false;
window.DEBUG_FORUM_AUTO_LISTENER = false;
window.DEBUG_WEIBO_AUTO_LISTENER = false;
console.log('✅ 已启用上下文监控日志');
```

#### 只启用实时同步日志
```javascript
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = false;
window.DEBUG_CONTEXT_EDITOR = false;
window.DEBUG_REAL_TIME_SYNC = true;
window.DEBUG_FORUM_AUTO_LISTENER = false;
window.DEBUG_WEIBO_AUTO_LISTENER = false;
console.log('✅ 已启用实时同步日志');
```

#### 只启用自动监听器日志
```javascript
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = false;
window.DEBUG_CONTEXT_EDITOR = false;
window.DEBUG_REAL_TIME_SYNC = false;
window.DEBUG_FORUM_AUTO_LISTENER = true;
window.DEBUG_WEIBO_AUTO_LISTENER = true;
console.log('✅ 已启用自动监听器日志');
```

## 高级控制函数

### 创建日志控制面板
```javascript
// 创建一个可视化的日志控制面板
function createLogControlPanel() {
  // 移除已存在的面板
  const existingPanel = document.getElementById('log-control-panel');
  if (existingPanel) {
    existingPanel.remove();
  }
  
  const panel = document.createElement('div');
  panel.id = 'log-control-panel';
  panel.innerHTML = `
    <div style="position: fixed; top: 10px; right: 10px; background: white; border: 2px solid #007cba; padding: 15px; z-index: 10000; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-family: Arial, sans-serif; min-width: 280px;">
      <h4 style="margin: 0 0 15px 0; color: #007cba; text-align: center;">📊 Message-App 日志控制</h4>
      
      <div style="margin-bottom: 12px;">
        <label style="display: flex; align-items: center; margin-bottom: 8px;">
          <input type="checkbox" id="debug-message-app" style="margin-right: 8px;">
          <span>Message-App 核心日志</span>
        </label>
        
        <label style="display: flex; align-items: center; margin-bottom: 8px;">
          <input type="checkbox" id="debug-message-renderer" style="margin-right: 8px;">
          <span>消息渲染日志</span>
        </label>
        
        <label style="display: flex; align-items: center; margin-bottom: 8px;">
          <input type="checkbox" id="debug-friend-renderer" style="margin-right: 8px;">
          <span>好友渲染日志</span>
        </label>
        
        <label style="display: flex; align-items: center; margin-bottom: 12px;">
          <input type="checkbox" id="debug-context-monitor" style="margin-right: 8px;">
          <span>上下文监控日志</span>
        </label>
      </div>
      
      <div style="display: flex; gap: 8px; margin-bottom: 12px;">
        <button id="enable-all" style="flex: 1; background: #28a745; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">全部启用</button>
        <button id="disable-all" style="flex: 1; background: #dc3545; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">全部关闭</button>
      </div>
      
      <div style="display: flex; gap: 8px;">
        <button id="clear-console" style="flex: 1; background: #ffc107; color: black; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">清空控制台</button>
        <button id="close-panel" style="flex: 1; background: #6c757d; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">关闭面板</button>
      </div>
    </div>
  `;
  
  document.body.appendChild(panel);
  
  // 设置当前状态
  document.getElementById('debug-message-app').checked = window.DEBUG_MESSAGE_APP || false;
  document.getElementById('debug-message-renderer').checked = window.DEBUG_MESSAGE_RENDERER || false;
  document.getElementById('debug-friend-renderer').checked = window.DEBUG_FRIEND_RENDERER || false;
  document.getElementById('debug-context-monitor').checked = window.DEBUG_CONTEXT_MONITOR || false;
  
  // 绑定事件
  document.getElementById('debug-message-app').addEventListener('change', (e) => {
    window.DEBUG_MESSAGE_APP = e.target.checked;
    console.log(`Message-App核心日志: ${e.target.checked ? '启用' : '禁用'}`);
  });
  
  document.getElementById('debug-message-renderer').addEventListener('change', (e) => {
    window.DEBUG_MESSAGE_RENDERER = e.target.checked;
    console.log(`消息渲染日志: ${e.target.checked ? '启用' : '禁用'}`);
  });
  
  document.getElementById('debug-friend-renderer').addEventListener('change', (e) => {
    window.DEBUG_FRIEND_RENDERER = e.target.checked;
    console.log(`好友渲染日志: ${e.target.checked ? '启用' : '禁用'}`);
  });
  
  document.getElementById('debug-context-monitor').addEventListener('change', (e) => {
    window.DEBUG_CONTEXT_MONITOR = e.target.checked;
    console.log(`上下文监控日志: ${e.target.checked ? '启用' : '禁用'}`);
  });
  
  document.getElementById('enable-all').addEventListener('click', () => {
    window.DEBUG_MESSAGE_APP = true;
    window.DEBUG_MESSAGE_RENDERER = true;
    window.DEBUG_FRIEND_RENDERER = true;
    window.DEBUG_CONTEXT_MONITOR = true;
    
    document.getElementById('debug-message-app').checked = true;
    document.getElementById('debug-message-renderer').checked = true;
    document.getElementById('debug-friend-renderer').checked = true;
    document.getElementById('debug-context-monitor').checked = true;
    
    console.log('✅ 所有调试日志已启用');
  });
  
  document.getElementById('disable-all').addEventListener('click', () => {
    window.DEBUG_MESSAGE_APP = false;
    window.DEBUG_MESSAGE_RENDERER = false;
    window.DEBUG_FRIEND_RENDERER = false;
    window.DEBUG_CONTEXT_MONITOR = false;
    
    document.getElementById('debug-message-app').checked = false;
    document.getElementById('debug-message-renderer').checked = false;
    document.getElementById('debug-friend-renderer').checked = false;
    document.getElementById('debug-context-monitor').checked = false;
    
    console.log('✅ 所有调试日志已关闭');
  });
  
  document.getElementById('clear-console').addEventListener('click', () => {
    console.clear();
    console.log('✅ 控制台已清空');
  });
  
  document.getElementById('close-panel').addEventListener('click', () => {
    panel.remove();
  });
}

// 注册全局函数
window.createLogControlPanel = createLogControlPanel;

// 执行函数创建面板
createLogControlPanel();
```

### 快捷键支持
```javascript
// 添加快捷键支持：Ctrl+Shift+L 打开日志控制面板
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.shiftKey && e.key === 'L') {
    e.preventDefault();
    if (typeof window.createLogControlPanel === 'function') {
      window.createLogControlPanel();
    } else {
      console.log('日志控制面板函数未加载，请先执行上面的代码');
    }
  }
});

console.log('✅ 快捷键已注册：Ctrl+Shift+L 打开日志控制面板');
```

## 使用建议

### 日常使用
建议关闭所有调试日志，保持控制台清洁：
```javascript
window.DEBUG_MESSAGE_APP = false;
window.DEBUG_MESSAGE_RENDERER = false;
window.DEBUG_FRIEND_RENDERER = false;
window.DEBUG_CONTEXT_MONITOR = false;
console.clear();
```

### 问题排查
根据问题类型选择性启用相关日志：

- **消息接收问题**：启用 `DEBUG_MESSAGE_APP`
- **消息显示问题**：启用 `DEBUG_MESSAGE_RENDERER`
- **好友列表问题**：启用 `DEBUG_FRIEND_RENDERER`
- **数据获取问题**：启用 `DEBUG_CONTEXT_MONITOR`

### 开发调试
开发时可以启用所有日志：
```javascript
window.DEBUG_MESSAGE_APP = true;
window.DEBUG_MESSAGE_RENDERER = true;
window.DEBUG_FRIEND_RENDERER = true;
window.DEBUG_CONTEXT_MONITOR = true;
```

## 注意事项

1. **性能影响**：启用调试日志会增加控制台输出，可能影响性能
2. **浏览器刷新**：刷新页面后需要重新设置日志开关
3. **持久化**：如需持久化设置，可以使用localStorage存储配置
4. **兼容性**：所有现代浏览器都支持这些控制命令
